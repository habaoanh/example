
# ‚ö°Ô∏è Full-Stack Project Rules (Frontend & Backend)

ƒê√¢y l√† workspace ch·ª©a c·∫£ Frontend (Next.js) v√† Backend (Node.js/Express).
D∆∞·ªõi ƒë√¢y l√† c√°c rule c·ª• th·ªÉ cho t·ª´ng ph·∫ßn. H√£y t·ª± ƒë·ªông nh·∫≠n di·ªán th∆∞ m·ª•c ƒëang l√†m vi·ªác ƒë·ªÉ √°p d·ª•ng rule ph√π h·ª£p.

---

## üü¢ FRONTEND RULES (`/quizBinh2-main`)

**Technology Stack:**
- Framework: **Next.js 14+ (App Router)**
- Styling: **Tailwind CSS**
- Language: **TypeScript (.tsx)**
- State Management: React Hooks, Context API

**Coding Standards:**
1.  **Strict Component Separation:**
    - M·ªói component ph·∫£i n·∫±m trong m·ªôt file ri√™ng bi·ªát.
    - ∆Øu ti√™n t√°i s·ª≠ d·ª•ng component UI trong `src/components/ui`.
    - Kh√¥ng vi·∫øt inline style, lu√¥n d√πng Utility Classes c·ªßa Tailwind.

2.  **Responsive Design (Mobile-First):**
    - Lu√¥n ƒë·∫£m b·∫£o giao di·ªán hi·ªÉn th·ªã t·ªët tr√™n Mobile tr∆∞·ªõc.
    - S·ª≠ d·ª•ng c√°c breakpoint `sm:`, `md:`, `lg:`, `xl:`, `2xl:` chu·∫©n c·ªßa Tailwind.
    - V·ªõi m√†n h√¨nh l·ªõn (2K+), s·ª≠ d·ª•ng `container mx-auto max-w-7xl` v√† ƒëi·ªÅu ch·ªânh `text-size`, `padding` ph√π h·ª£p.

3.  **Next.js Optimization:**
    - S·ª≠ d·ª•ng `<Image />` thay v√¨ `<img>`.
    - S·ª≠ d·ª•ng `<Link />` thay v√¨ `<a>`.
    - Component n√†o c·∫ßn t∆∞∆°ng t√°c/hooks th√¨ ph·∫£i c√≥ `"use client"`.
    - Server Component l√† m·∫∑c ƒë·ªãnh.

4.  **Error Handling:**
    - Lu√¥n ki·ªÉm tra `suppressHydrationWarning` n·∫øu s·ª≠a layout ch√≠nh.
    - X·ª≠ l√Ω l·ªói API gracefuly (hi·ªÉn th·ªã th√¥ng b√°o toast/l·ªói thay v√¨ crash app).

---

## üîµ BACKEND RULES : ·ª©ng d·ª•ng h·ªçc To√°n (l·ªõp 6 - 12) theo ch∆∞∆°ng tr√¨nh m·ªõi c·ªßa B·ªô GD&ƒêT (ƒë·∫∑c bi·ªát l√† ƒë·ªãnh d·∫°ng thi THPTQG 2025), backend d√πng express v√† c√°c dependency sao cho ·ª©ng d·ª•ng c·ªßa t√¥i ƒë√°p ·ª©ng c√°c ti√™u chu·∫©n: ƒë∆°n gi·∫£n, ·ªïn ƒë·ªãnh, b·∫£o m·∫≠t, hi·ªán ƒë·∫°i....

**Technology Stack:**
- Runtime: **Node.js**
- Framework: **Express.js**
- Database: **MongoDB (Mongoose)**
- Language: **JavaScript (ES6+)**

**Coding Standards:**
1.  **Project Structure:**
    - Controllers: X·ª≠ l√Ω logic request/response.
    - Models: ƒê·ªãnh nghƒ©a Schema Database.
    - Routes: ƒê·ªãnh nghƒ©a endpoint API.
    - Middleware: X·ª≠ l√Ω auth, error handling, validation.

2.  **Security Best Practices:**
    - Kh√¥ng hardcode credentials, lu√¥n d√πng `process.env`.
    - Validate input data b·∫±ng Joi ho·∫∑c express-validator tr∆∞·ªõc khi x·ª≠ l√Ω.
    - S·ª≠ d·ª•ng `helmet` v√† `cors` ƒë√∫ng c√°ch.

3.  **API Standards:**
    - T√¥n tr·ªçng chu·∫©n RESTful API.
    - Response lu√¥n tr·∫£ v·ªÅ JSON th·ªëng nh·∫•t: `{ success: boolean, data?: any, message?: string }`.
    - HTTP Status Code ph·∫£i ƒë√∫ng ng·ªØ nghƒ©a (200, 201, 400, 401, 404, 500).
    - Base URL chu·∫©n: `/api/v1/...` (ho·∫∑c `/api/...` t√πy config hi·ªán t·∫°i).

4.  **Environment:**
    - Lu√¥n load `dotenv` ngay d√≤ng ƒë·∫ßu ti√™n c·ªßa `server.js` ho·∫∑c entry point (`import 'dotenv/config'`).
    - Ch√∫ √Ω conflict PORT (th∆∞·ªùng d√πng `5001` ƒë·ªÉ tr√°nh conflict v·ªõi Frontend/System services).
5.  - Vui l√≤ng cung c·∫•p c√°c API endpoints ƒë·ªÉ ki·ªÉm th·ª≠ b·∫±ng REST Client.
    - N·∫øu d√πng ai th√¨ d√πng mdel: gemini-3-flash-preview

-------

## ü§ù INTERGRATION RULES (K·∫øt n·ªëi FE - BE)

1.  **CORS & Proxy:**
    - Backend ph·∫£i cho ph√©p Frontend domain truy c·∫≠p.
    - Thi·∫øt l·∫≠p proxy  ƒë·ªÉ giao ti·∫øp gi·ªØa fontend v√† backend

2.  **Data Consistency:**
    - Khi s·ª≠a Model ·ªü Backend -> Ph·∫£i c·∫≠p nh·∫≠t Interface/Type ·ªü Frontend ngay l·∫≠p t·ª©c.
    - Khi ƒë·ªïi Route API ·ªü Backend -> Ph·∫£i c·∫≠p nh·∫≠t file g·ªçi API (v√≠ d·ª• `api.http` ho·∫∑c service file) ·ªü Frontend.

---

## üîí QUIZ SECURITY & LOGIC (Quan tr·ªçng)

1.  **Server-Side Validation:**
    - Tuy·ªát ƒë·ªëi KH√îNG g·ª≠i ƒë√°p √°n ƒë√∫ng (`correctAnswer`) v·ªÅ Client khi ƒëang l√†m b√†i.
    - Vi·ªác ch·∫•m ƒëi·ªÉm ph·∫£i th·ª±c hi·ªán tr√™n Server.
2.  **Anti-Cheat Basic:**
    - Th√™m CSS `user-select: none` v√†o n·ªôi dung c√¢u h·ªèi ƒë·ªÉ h·∫°n ch·∫ø copy/paste.
    - C·∫£nh b√°o ng∆∞·ªùi d√πng n·∫øu r·ªùi tab khi ƒëang thi (s·ª≠ d·ª•ng `visibilitychange` event).
3.  **Rate Limiting:**
    - Gi·ªõi h·∫°n s·ªë l·∫ßn submit b√†i thi tr√™n m·ªôt kho·∫£ng th·ªùi gian ng·∫Øn ƒë·ªÉ tr√°nh spam.

---

## ‚ú® MODERN UX/UI (Tr·∫£i nghi·ªám ng∆∞·ªùi d√πng)

1.  **Loading States:**
    - S·ª≠ d·ª•ng **Skeleton** thay v√¨ Spinner tr√≤n cho c√°c kh·ªëi n·ªôi dung l·ªõn (danh s√°ch ƒë·ªÅ thi, b·∫£ng x·∫øp h·∫°ng).
2.  **Optimistic UI:**
    - Hi·ªÉn th·ªã k·∫øt qu·∫£ "th√†nh c√¥ng" ngay l·∫≠p t·ª©c khi ng∆∞·ªùi d√πng thao t√°c (v√≠ d·ª•: L∆∞u b√†i, Th·∫£ tim) tr∆∞·ªõc khi Server ph·∫£n h·ªìi. Revert l·∫°i n·∫øu l·ªói.
3.  **Micro-Interactions:**
    - Th√™m hi·ªáu ·ª©ng hover, active nh·∫π nh√†ng cho c√°c n√∫t b·∫•m v√† th·∫ª b√†i h·ªçc.
    - S·ª≠ d·ª•ng Toast Notification (`sonner` ho·∫∑c `react-hot-toast`) thay v√¨ `alert()` m·∫∑c ƒë·ªãnh.

---

## üõ† CODE QUALITY & PERFORMANCE

1.  **Strict Types:** h·∫°n ch·∫ø t·ªëi ƒëa `any`. ƒê·ªãnh nghƒ©a Interface r√µ r√†ng cho m·ªçi API Response.
2.  **Database Indexing:** ƒê√°nh index cho c√°c tr∆∞·ªùng hay query trong MongoDB (`userId`, `slug`, `status`).
3.  **Error Boundaries:** B·ªçc c√°c widget quan tr·ªçng (nh∆∞ Khung chat, B·∫£ng x·∫øp h·∫°ng) trong Error Boundary ƒë·ªÉ tr√°nh crash to√†n trang.


---

## üö® USER-DEFINED CRITICAL WORKFLOW RULES (MANDATORY)

### 1. üõ°Ô∏è Stability First & Component Strategy
- **IMMUTABLE UI/UX**: Do not change existing functions or UI unless explicitly permitted.
- **Check Before Create**: Before creating any new component, MUST check if a similar one exists.
- **Refactor > Create**: Prioritize updating/generalizing existing components over creating new ones.
- **Atomic Design**: Break down code into reusable components (Button, Card, Header, List, Input) to avoid duplication.

### 2. üáªüá≥ Vietnamese Explanation Protocol (CRITICAL)
- **EVERY CHANGE MUST BE EXPLAINED IN VIETNAMESE.**
- Format for every code change:
  - **L√Ω do (Why):** Why is this change needed?
  - **Gi·∫£i quy·∫øt (Solution):** What problem does this specific code solve?
  - **L·ª£i √≠ch (Benefit):** Why is this better than the old approach.

### 3. üöÄ ReactJS to Next.js Migration Standard
- **Strict Tag Replacement**:
  - `<a>` ‚Üí `<Link>`
  - `<img>` ‚Üí `<Image>`
- **Architecture**:
  - Use **App Router**.
  - Explicitly define `"use client"` or default to Server Components.
  - Optimize for SEO and Performance in every step.

### 4. üê¢ Step-by-Step Workflow
- **No Mass Changes**: Work in small, verifiable steps.
- **Refactor Proposals**: ANY refactor suggestion must include:
  - **L√Ω do (Reason)**
  - **Ph·∫°m vi ·∫£nh h∆∞·ªüng (Scope of Impact)**


---

## üö® REACTJS MIGRATION & COMPONENT REFACTORING PROTOCOL

### 1. üßπ Data Cleaning & Preparation
- **REMOVE DARK MODE**: Strip out all dark mode related code/classes from pasted ReactJS code.
- **Preserve UI/UX**:
  - **NO className Changes**: Keep classNames exactly as they are (unless removing dark mode).
  - **No HTML Structure Changes**: Unless absolutely necessary for Next.js compatibility.

### 2. ‚öõÔ∏è Next.js Strict Migration
- **Tag Replacement**:
  - `<a>` ‚Üí `<Link href="...">` (import from `next/link`)
  - `<img>` ‚Üí `<Image src="..." ... />` (import from `next/image`)
- **Imports**: Ensure correct imports from `next/link` and `next/image`.
- **Suggestions Only**: If code is incompatible with Next.js (e.g., heavily reliant on `window`), PROPOSE a solution first, do not simple delete.

### 3. üìÇ UI Component Strategy (`components/UI`)
- **Location**: All reusable UI components (Button, Card, Badge, List, Modal, Container) MUST go to `components/UI`.
- **Refactoring Goals**:
  - **Generalize**: Detect duplicates and create flexible, reusable components.
  - **Pure UI**: Components in `components/UI` must NOT contain business logic. They only receive props.
- **Workflow**:
  - Check if component exists -> Update/Generalize -> Create new only if necessary.
  - **Explain**: For every new/refactored component, explain in Vietnamese:
    - Why it is shared? (T·∫°i sao c·∫ßn t√°ch?)
    - Props explanation? (Gi·∫£i th√≠ch Props)
    - Usage examples? (V√≠ d·ª• s·ª≠ d·ª•ng)

### 4. üìù Explanation Requirements
- **Vietnamese Only**: All explanations for migration and refactoring must be in Vietnamese.